<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.14 (458265)"/><meta name="altitude" content="177.4443664550781"/><meta name="author" content="cafaray@gmail.com"/><meta name="created" content="2020-06-10 07:50:57 +0000"/><meta name="latitude" content="41.54173868119938"/><meta name="longitude" content="2.1105808607395"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2020-06-11 12:55:51 +0000"/><title>Kong on the way</title></head><body><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">Create a docker network</span></div><div><span style="font-size: 12px; --inversion-type-color:  simple; color: rgb(0, 0, 0);">This network will be use for kong and our API server:</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>docker network create kong-net</div></div><div><br/></div><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">Start database for Kong</span></div><div>There is two option database : Postgres or Cassandra. For this sample we use postgres.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>docker run -d --name kong-database \</div><div>--network=kong-net \</div><div>-p 5432:5432 \</div><div>-e "POSTGRES_USER=kong" \</div><div>-e "POSTGRES_DB=kong" \</div><div>-e "POSTGRES_PASSWORD=kong" \</div><div>postgres:9.6</div></div><div><br/></div><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">Prepare database</span></div><div>run migration with Kong container:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>docker run --rm \</div><div>--network=kong-net \</div><div>-e "KONG_DATABASE=postgres" \</div><div>-e "KONG_PG_HOST=kong-database" \</div><div>-e "KONG_PG_PASSWORD=kong" \</div><div>-e "KONG_CASSANDRA_CONTACT_POINTS=kong-database" \</div><div>kong:latest kong migrations bootstrap</div></div><div><br/></div><div><span style="--inversion-type-color: simple; color: rgb(255, 147, 0);">reponse like:</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>...</div><div>migrating session on database 'kong'...</div><div>session migrated up to: 000_base_session (executed)</div><div>24 migrations processed</div><div>24 executed</div><div>Database is up-to-date</div></div><div><br/></div><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">Start a kong container</span></div><div>Once the migrations have run and your database is ready, .</div><div>in this case, we are using the</div><div>- port 8000/8443 to get access to KONG</div><div>- port 8001/8444 to get access to Admin KONG</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>docker run -d --name kong \</div><div>--network=kong-net \</div><div>-e "KONG_DATABASE=postgres" \</div><div>-e "KONG_PG_HOST=kong-database" \</div><div>-e "KONG_PG_PASSWORD=kong" \</div><div>-e "KONG_CASSANDRA_CONTACT_POINTS=kong-database" \</div><div>-e "KONG_PROXY_ACCESS_LOG=/dev/stdout" \</div><div>-e "KONG_ADMIN_ACCESS_LOG=/dev/stdout" \</div><div>-e "KONG_PROXY_ERROR_LOG=/dev/stderr" \</div><div>-e "KONG_ADMIN_ERROR_LOG=/dev/stderr" \</div><div>-e "KONG_ADMIN_LISTEN=0.0.0.0:8001, 0.0.0.0:8444 ssl" \</div><div>-p 8000:8000 \</div><div>-p 8443:8443 \</div><div>-p 8001:8001 \</div><div>-p 8444:8444 \</div><div>kong:latest</div></div><div><br/></div><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">Check Kong Instance</span></div><div>Invoke</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl -i http://localhost:8001</div></div><div><br/></div><div><span style="--inversion-type-color: simple; color: rgb(255, 147, 0);">the expected response is something like this:</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>HTTP/1.1 200 OK</div><div>Server: openresty/1.13.6.2</div><div>Date: Wed, 18 Jul 2018 03:58:57 GMT</div><div>Content-Type: application/json</div><div>Connection: keep-alive</div><div>Access-Control-Allow-Origin: *</div></div><div><br/></div><div>(Shellscript to autovalidate, could be useful)</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>RESPONSE=$(curl -i "http://localhost:8001" | grep '200 OK')</div><div>EXPECTED_RESPONSE="HTTP/1.1 200 OK"</div><div>echo "response: $RESPONSE"</div><div>if [ "$RESPONSE" == "$EXPECTED_RESPONSE" ]; then</div><div>echo "Now Kong is up and ready to be used"</div><div>fi</div></div><div><br/></div><div><span style="--inversion-type-color:  simple; color: rgb(6, 255, 6); font-style: italic;">Now Kong is up and ready to be used. </span></div><div><br/></div><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">Set a (nano) API Rest for test Kong</span></div><div>The next thing is prepare an API server that contain service routes and can be accessed as REST API use to be.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>APP_WORKSPACE=$HOME/workspace</div><div>APP_NAME=nano-api-test</div></div><div><br/></div><div>Prepare the API server, for this tutorial we are going to use node.js and docker</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>cd $APP_WORKSPACE</div><div>git clone https://github.com/cafaray/nano-api-test.git</div><div>cd "$APP_NAME"</div></div><div><br/></div><div>build the docker in your local to start up the API Server</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>docker build -t node_kong .</div></div><div><br/></div><div><span style="color: rgb(255, 38, 0); --inversion-type-color: simple;">npm notice created a lockfile as package-lock.json. You should commit this file.</span></div><div><span style="color: rgb(255, 38, 0); --inversion-type-color: simple;">npm WARN docker_node_for_kong@1.0.0 No repository field.</span></div><div><span style="color: rgb(255, 38, 0); --inversion-type-color: simple;">npm WARN docker_node_for_kong@1.0.0 No license field.</span></div><div><br/></div><div>run the docker container</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>docker run -d --name=node_kong --network=kong-net node_kong</div></div><div><br/></div><div># verify you have the three components needed</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>docker ps -a</div></div><div><br/></div><div># ############################################################################################################################## #</div><div># CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES #</div><div># ------------------------------------------------------------------------------------------------------------------------------ #</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>d13586f83e52     node_kong       “npm start” 2 minutes ago Up 2 minutes         10000/tcp node_kong </div><div>41156cad5c86     kong:latest     “/docker-entrypoint.…” 6 days ago Up 6 days    0.0.0.0:9000-&gt;8000/tcp,   kong </div><div>                                                                                0.0.0.0:9001-&gt;8001/tcp,</div><div>                                                                                0.0.0.0:9443-&gt;8443/tcp,</div><div>                                                                                0.0.0.0:9444-&gt;8444/tcp </div><div>f794a0e9506c     postgres:9.6    “docker-entrypoint.s…” 6 days ago Up 6 days    0.0.0.0:5555-&gt;5432/tcp    kong-database</div></div><div># ############################################################################################################################## #</div><div><br/></div><div>Check API server by access its API.</div><div>We need to get IP container on docker network kong-net.</div><div>After that get into container kong shell and check the API from it.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>docker network inspect kong-net</div></div><div><br/></div><div><span style="--inversion-type-color: simple; color: rgb(255, 147, 0);">Expected response:</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>…</div><div>…</div><div>“Containers”: {</div><div>    “41156cad5c864af4ad8615c051fac8da7f683238a6c8cc42267f02813f14810f”: {</div><div>        “Name”: “kong”,</div><div>        “EndpointID”: “fe1cec9f6f31a015ab29a100fdd54b609abea11bbfa00f5e9ca67cc6175d7b2f”,</div><div>        “MacAddress”: “02:42:ac:13:00:03”,</div><div>        “IPv4Address”: “172.19.0.3/16”,</div><div>        “IPv6Address”: “”</div><div>    },</div><div>    “d13586f83e52df8866b9879ba0537d58c21fc1b95978dde0580b017ce1a7b418”: {</div><div>        “Name”: “node_kong”,</div><div>        “EndpointID”: “5677f7588b7daef391cf8cecec6a3ede0155f99f7d86e0e14dd5970ff0570924”,</div><div>        “MacAddress”: “02:42:ac:13:00:04”,</div><div>        “IPv4Address”: “172.19.0.4/16”,</div><div>        “IPv6Address”: “”</div><div>    },</div><div>    “f794a0e9506c7330f1cc19c5c390f745823c29dd4603e0d727dae4e8a68caa8d”: {</div><div>        “Name”: “kong-database”,</div><div>        “EndpointID”: “51737ca4e2a4b0e30d25db86e197e653a81e6206893588f4dae7b4a0a50e2799”,</div><div>        “MacAddress”: “02:42:ac:13:00:02”,</div><div>        “IPv4Address”: “172.19.0.2/16”,</div><div>        “IPv6Address”: “”</div><div>    }</div><div>},</div><div>...</div><div><div><br/></div><div><br/></div></div></div><div><br/></div><div>Take care in <span style="font-weight: bold;">the IP</span> of <span style="font-weight: bold;">node_kong container</span>, it will be used in follow steps</div><div><br/></div><div>Execute from <span style="font-weight: bold;">kong container</span> the curl to the IP of <span style="font-weight: bold;">node_kong container</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>docker exec -ti kong sh / # curl -i {{ip_node_kong}}:10000/customers</div></div><div><br/></div><div><span style="--inversion-type-color:  simple; color: rgb(191, 0, 191); font-weight: bold;">If any trouble, try this —&gt; </span></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; caret-color: rgba(0, 0, 0, 0); background-color: rgb(34, 34, 34);"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl -I {{ip_node_kong}}:10000/customers</div></div><div><br/></div><div><span style="--inversion-type-color:  simple; color: rgb(191, 0, 191); font-weight: bold;">&lt;— </span></div><div><br/></div><div>The response must be very likely:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>HTTP/1.1 200 </div><div>OKX-Powered-By: Express</div><div>Content-Type: application/json; charset=utf-8</div><div>Content-Length: 110</div><div>ETag: W/"6e-Tf3vAGLC3XH0dFR2pCIzWdG8/5c”</div><div>Date: Wed, 10 Jun 2020 12:22:16 GMT</div><div>Connection: keep-alive</div><div><br/></div><div>[</div><div>    {</div><div>        "id”:1,</div><div>        "first_name”:"Barley”,</div><div>        "last_name”:”Inspector"</div><div>    },{</div><div>        "id”:2,</div><div>        "first_name”:"Ian”,</div><div>        "last_name”:”Ligthfoot"</div><div>    }</div><div>]</div></div><div><br/></div><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">Setup KONG as API-gateway</span> </div><div>Configure the API gateway to the API server routing. Routes are entry-points in Kong and define rules to match client requests.</div><div>Once a Route is matched, Kong proxies the request to its associated Service.</div><div>The service that has been defined will be direct to API server that is ready to serve.</div><div>API server that is live on server http://172.19.0.4:10000/api/v1/customers</div><div>We set the next route path</div><div><br/></div><div><span style="--inversion-type-color:  simple; color: rgb(6, 255, 6);">/api/v1/customers</span></div><div><br/></div><div>And set the service host to </div><div><br/></div><div><span style="--inversion-type-color:  simple; color: rgb(6, 255, 6);">http://{{ip_node_kong}}:10000/api/v1/customers</span></div><div><br/></div><div>So, when client request to kong (in this case kong is live at localhost:8000) with path route <span style="--inversion-type-color: simple; color: rgb(255, 251, 0); font-weight: bold;">/api/v1/customer</span> : in complete client request:</div><div><br/></div><div><span style="--inversion-type-color:  simple; color: rgb(6, 255, 6);">http://localhost:8000/api/v1/customers</span></div><div><br/></div><div>Kong will proxy it to {{ip_node_kong}}:10000/api/v1/customers</div><div><br/></div><div>To setup your services, go to source documentation for get a guide fot it</div><div><br/></div><div><a href="https://docs.konghq.com/2.0.x/getting-started/configuring-a-service/">https://docs.konghq.com/2.0.x/getting-started/configuring-a-service/</a></div><div><br/></div><div>Create a service in Kong:</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl --location --request POST 'localhost:8001/services/' \</div><div>--header 'Content-Type: application/json' \</div><div>--data-raw '{ "name": "api-v1", "url": "http://172.23.0.4:10000/api/v1" }'</div></div><div><br/></div><div>Get services from Kong</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl --location --request GET 'localhost:8001/services'</div></div><div><br/></div><div><span style="color: rgb(255, 38, 0); --inversion-type-color: simple;">Remove service by id</span></div><div><span style="color: rgb(255, 38, 0); --inversion-type-color: simple;">$KONG_SERVICE_ID=93f1bb40-2f87-428c-8df6-8e35446abffb</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl --location --request DELETE 'localhost:8001/services/$KONG_SERVICE_ID'</div></div><div><br/></div><div><span style="color: rgb(0, 253, 255); --inversion-type-color: simple;">Create a route for the service.</span></div><div>the path "/" should allow to invoke the path defined in the app, in our case we have:</div><div><br/></div><div>/customers</div><div>/clients</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl --location --request POST 'localhost:8001/services/api-v1/routes/' \</div><div>--header 'Content-Type: application/json' \</div><div>--data-raw '{ "hosts": [“apitrain2o2o"], "paths": ["/"] }'</div></div><div><br/></div><div>Get the routes from Kong</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl --location --request GET 'localhost:8001/routes'</div></div><div><br/></div><div>Test the service -&gt; route -&gt; backend</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl --location --request GET 'localhost:8000/customers' --header 'Host: apitrain2o2o'</div></div><div><br/></div><div>At this moment, Kong is working as a proxy, routing requests from localhost:8000 -&gt; {{ip_node_kong}}:10000/api/v1</div><div><br/></div><div><span style="color: rgb(0, 253, 255); --inversion-type-color: simple;">Secure the endpoints</span></div><div>First start with simple basic authentication through API-KEY token plugin, more details in plugins <a href="https://docs.konghq.com/hub/">here</a> </div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl -i -X POST --url http://localhost:8001/services/api-v1/plugins/ --data 'name=key-auth'</div></div><div><br/></div><div>Invoke to customers o clients application endpoint and verify that the plugin is properly configured</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{</div><div>    "message": "No API key found in request”</div><div>}</div></div><div><br/></div><div><span style="color: rgb(0, 253, 255); --inversion-type-color: simple;">Set the consumer</span></div><div>Create a consumer for the customer and clients app endpoints, in this way the consumer will be identified</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl -i -X POST --url http://localhost:8001/consumers/ --data "username=dash@i.db.com"</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Response like this:</div><div>HTTP/1.1 201 </div><div>CreatedDate: Thu, 11 Jun 2020 08:46:07 GMT</div><div>Content-Type: application/json; charset=utf-8</div><div>Connection: keep-alive</div><div>Access-Control-Allow-Origin: *Server: kong/2.0.4</div><div>Content-Length: 130</div><div>X-Kong-Admin-Latency: 5</div><div><br/></div><div>{</div><div>    "custom_id":null,</div><div>    "created_at":1591865167,</div><div>    "id":"8df0ede6-1116-41b5-a632-125401c2aadd”,</div><div>    "tags":null,</div><div>    "username":"nofolk@someone.com”</div><div>}</div></div><div><br/></div><div><span style="color: rgb(0, 253, 255); --inversion-type-color: simple;">Provision key credentials</span></div><div>Grant the recent consumer with an apikey for consume app’s endpoints</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl -i -X POST --url http://localhost:8001/consumers/8df0ede6-1116-41b5-a632-125401c2aadd/key-auth/ --data 'key=MTU4NDgyNzc3MmRhc2hAaS5kYi5jb20K'</div></div><div><br/></div><div>The response:</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>HTTP/1.1 201 </div><div>CreatedDate: Thu, 11 Jun 2020 08:49:27 GMT</div><div>Content-Type: application/json; charset=utf-8</div><div>Connection: keep-alive</div><div>Access-Control-Allow-Origin: *Server: kong/2.0.4</div><div>Content-Length: 190</div><div>X-Kong-Admin-Latency: 7</div><div><br/></div><div>{</div><div>    "created_at":1591865367,</div><div>    "consumer”:{</div><div>        "id":"8df0ede6-1116-41b5-a632-125401c2aadd”</div><div>    },</div><div>    "id":"ac361bdb-e742-4d1f-9af9-26e9850ff2b4”,</div><div>    "tags":null,</div><div>    "ttl":null,</div><div>    "key":”MTU4NDgyNzc3MmRhc2hAaS5kYi5jb20K"</div><div>}</div></div><div><br/></div><div><span style="color: rgb(0, 253, 255); --inversion-type-color: simple;">Test the apikey token</span></div><div>Set the api key in the param section to test apikey token is working properly:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>curl --location --request GET 'localhost:8000/customers' --header 'Host: apitrain2o2o' --header 'apikey: MTU4NDgyNzc3MmRhc2hAaS5kYi5jb20K'</div></div><div><br/></div><div>Response expected:</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[</div><div>    {</div><div>        "id": 1,</div><div>        "first_name": "Manticore",</div><div>        "last_name": "Spencer"</div><div>    },</div><div>    {</div><div>        "id": 2,</div><div>        "first_name": "Laurel",</div><div>        "last_name": "Dreyfus"</div><div>    }</div><div>]</div></div><div><br/></div><div>Find more info about this plugin <a href="https://docs.konghq.com/hub/kong-inc/key-auth/">here</a></div><div><br/></div><div><span style="color: rgb(0, 253, 255); --inversion-type-color: simple;"><br/></span></div></body></html>